!function(){"use strict";var t={64:function(t){t.exports=AssetAdminModalActions},145:function(t){t.exports=ReactDomClient},207:function(t){t.exports=Injector},502:function(t){t.exports=ShortcodeSerialiser},594:function(t){t.exports=React},643:function(t){t.exports=InsertMediaModal},669:function(t){t.exports=jQuery},759:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.imageSizePresetButtons=function(t,e){return e.map(e=>function(t,e){const{name:i,width:n,text:a}=e,r=`ssmedia${i}`;t.on("init",()=>{t.formatter.register(r,{selector:"img",attributes:{width:n?n.toString():""}})});const o=()=>{let e=t.selection.getNode();return"IMG"!==e.tagName&&e.children.item("img")&&(e=e.children.item("img")),e&&"IMG"===e.tagName?e:void 0},s=t=>{const e=o();t.disabled(!(!e||!n)&&e.naturalWidth<n)},d=()=>{if(t.formatter.match(r))return!0;const e=o();if(!n&&e){const t=e.getAttribute("width");return!t||t.toString()===e.naturalWidth.toString()}return!1},l=e=>{const i=e.target,a=()=>{i.active(d())};if(t.on("NodeChange",()=>{s(i),a()}),s(i),t.formatter&&(t.formatter.formatChanged(r,a),d())){t.formatter.apply(r);const e=o();e&&e.setAttribute("width",n||e.naturalWidth)}},c=()=>{const e=o();e&&(e.removeAttribute("height"),e.removeAttribute("width"),t.formatter.apply(r),n?e.setAttribute("height",e.clientHeight):(e.setAttribute("width",e.naturalWidth),e.setAttribute("height",e.naturalHeight)))};return t.ui.registry.addButton(r,{text:a,onAction:c,onPostRender:l}),r}(t,e))}},815:function(t){t.exports=i18n}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}var n=g(i(669)),a=g(i(815)),r=g(i(594)),o=i(145),s=u(i(207)),d=g(i(643)),l=u(i(502)),c=u(i(64)),m=i(759);function u(t,e){if("function"==typeof WeakMap)var i=new WeakMap,n=new WeakMap;return(u=function(t,e){if(!e&&t&&t.__esModule)return t;var a,r,o={__proto__:null,default:t};if(null===t||"object"!=typeof t&&"function"!=typeof t)return o;if(a=e?n:i){if(a.has(t))return a.get(t);a.set(t,o)}for(const e in t)"default"!==e&&{}.hasOwnProperty.call(t,e)&&((r=(a=Object.defineProperty)&&Object.getOwnPropertyDescriptor(t,e))&&(r.get||r.set)?a(o,e,r):o[e]=t[e]);return o})(t,e)}function g(t){return t&&t.__esModule?t:{default:t}}const p=(0,s.loadComponent)(d.default),f='img[data-shortcode="image"]';(()=>{const t={init(t){const e=a.default._t("TinyMCE.INSERT_FROM_FILES","Insert from Files"),i=a.default._t("TinyMCE.EDIT_IMAGE","Edit image"),r=a.default._t("TinyMCE.DELETE_IMAGE","Delete image"),o=a.default._t("TinyMCE.FILE","File");t.addCommand("ssmedia",()=>{(0,n.default)(`#${t.id}`).entwine("ss").openMediaDialog()}),t.addCommand("ssmedia-delete",()=>{const e=t.selection.getNode();t.dom.is(e,f)?e.remove():console.error({error:"Unexpected selection - expected image",selectedNode:e})}),t.ui.registry.addButton("ssmedia",{tooltip:e,icon:"image",onAction:()=>t.execCommand("ssmedia"),stateSelector:f}),t.ui.registry.addMenuItem("ssmedia",{text:o,icon:"image",onAction:()=>t.execCommand("ssmedia")}),t.ui.registry.addButton("ssmediaedit",{tooltip:i,icon:"edit-block",onAction:()=>t.execCommand("ssmedia")}),t.ui.registry.addButton("ssmediadelete",{tooltip:r,icon:"remove",onAction:()=>t.execCommand("ssmedia-delete")});const s=t.getParam("image_size_presets");let d=[];return s&&(d=(0,m.imageSizePresetButtons)(t,s)),t.ui.registry.addContextToolbar("ssmedia",{predicate:e=>t.dom.is(e,f),position:"node",scope:"node",items:`${d.join(" ")} | ssmediaedit ssmediadelete`}),t.on("BeforeExecCommand",e=>{const i=e.command,n=e.ui,a=e.value;"mceEditImage"!==i&&"mceImage"!==i||(e.preventDefault(),t.execCommand("ssmedia",n,a))}),t.on("GetContent",t=>{const e=(0,n.default)(`<div>${t.content}</div>`);e.find(f).add(e.filter(f)).each(function(){const t=(0,n.default)(this),e={src:t.attr("src"),id:t.data("id"),width:t.attr("width"),height:t.attr("height"),class:t.attr("class"),title:t.attr("title"),alt:t.attr("alt"),loading:t.data("loading")},i=l.default.serialise({name:"image",properties:(0,l.sanitiseShortCodeProperties)(e),wrapped:!1});t.replaceWith(i)}),t.content="",e.each(function(){void 0!==this.innerHTML&&(t.content+=this.innerHTML)})}),t.on("BeforeSetContent",t=>{let e=t.content,i=l.default.match("image",!1,e);for(;i;){const t=i.properties,a=(0,n.default)("<img>").attr(Object.assign({},t,{id:void 0,"data-id":t.id,"data-shortcode":"image","data-loading":t.loading})).addClass("ss-htmleditorfield-file image");e=e.replace(i.original,(0,n.default)("<div></div>").append(a).html()),i=l.default.match("image",!1,e)}t.content=e}),{getMetadata(){return{name:"Silverstripe Media",url:"https://docs.silverstripe.org/en/4/developer_guides/forms/field_types/htmleditorfield"}}}}};tinymce.PluginManager.add("ssmedia",e=>t.init(e))})(),n.default.entwine("ss",t=>{t(".js-injector-boot #insert-media-react__dialog-wrapper").entwine({Element:null,Data:{},ReactRoot:null,onunmatch(){this._clearModal()},_clearModal(){const t=this.getReactRoot();t&&(t.unmount(),this.setReactRoot(null))},open(){const{dispatch:t}=s.default.reducer.store;t(c.initFormStack("insert-media","admin"));const e=tinymce.activeEditor.getParam("image_size_presets");t(c.defineImageSizePresets(e)),this._renderModal(!0)},close(){const{dispatch:t}=s.default.reducer.store;t(c.reset()),this._renderModal(!1)},_renderModal(t){const{url:e,...i}=this.getOriginalAttributes(),n=i.hasOwnProperty("ID")&&null!==i.ID,a=this.getFolderId(),s=this.getElement().getEditor(),d=s.getInstance().selection,l=s.getSelection(),c=d.getNode().tagName,m="A"!==c&&("IMG"===c||""===l.trim());let u=this.getReactRoot();u||(u=(0,o.createRoot)(this[0])),u.render(r.default.createElement(p,{title:!1,isOpen:t,folderId:a,onInsert:(...t)=>this._handleInsert(...t),onClosed:()=>this.close(),bodyClassName:"modal__dialog",className:"insert-media-react__dialog-wrapper",requireLinkText:m,fileAttributes:i,fileSelected:n})),this.setReactRoot(u)},_handleInsert(t,e){let i=!1;this.setData(Object.assign({},t,e));try{let t=null;if(t=e?e.category:"image","image"===t)i=this.insertImage();else i=this.insertFile()}catch(t){this.statusMessage(t,"bad")}return i&&this.close(),Promise.resolve()},getFolderId(){const t=this.getElement();if(!t)return null;const e=Number(t.data("config").upload_folder_id);return isNaN(e)?null:e},getOriginalAttributes(){const e=this.getElement();if(!e)return{};const i=e.getEditor().getSelectedNode();if(!i)return{};const n=t(i),a=(n.attr("href")||"").split("#");if(a[0]){const t=l.default.match("file_link",!1,a[0]);if(t)return{ID:t.properties.id?parseInt(t.properties.id,10):0,Anchor:a[1]||"",Description:n.attr("title"),TargetBlank:!!n.attr("target")}}const r=n.parent(".captionImage").find(".caption"),o={url:n.attr("src"),AltText:n.attr("alt"),Width:n.attr("width"),Height:n.attr("height"),Loading:n.attr("data-loading"),TitleTooltip:n.attr("title"),Alignment:this.findPosition(n.attr("class")),Caption:r.text(),ID:n.attr("data-id")};return["Width","Height","ID"].forEach(t=>{o[t]="string"==typeof o[t]?parseInt(o[t],10):null}),o},findPosition(t){if("string"!=typeof t)return"";const e=t.split(" ");return["leftAlone","center","rightAlone","left","right"].find(t=>e.indexOf(t)>-1)},getAttributes(){const t=this.getData();return{src:t.url,alt:t.AltText,width:t.Width,height:t.Height,title:t.TitleTooltip,class:t.Alignment,"data-id":t.ID,"data-shortcode":"image","data-loading":t.Loading}},getExtraData(){const t=this.getData();return{CaptionText:t&&t.Caption}},insertFile(){const e=this.getData(),i=this.getElement().getEditor(),n=t(i.getSelectedNode()),a=l.default.serialise({name:"file_link",properties:{id:e.ID}},!0);let r=i.getSelection()||e.Text||e.filename;n.is("a")&&n.html()&&(r="");const o={href:a,target:e.TargetBlank?"_blank":"",title:e.Description};if(n.is("img")){r=e.Text||e.filename;const a=t("<a />").attr(o).text(r);n.replaceWith(a),i.addUndo(),i.repaint()}else this.insertLinkInEditor(o,r);return!0},insertImage(){const e=this.getElement();if(!e)return!1;const i=e.getEditor();if(!i)return!1;const n=t(i.getSelectedNode()),a=this.getAttributes(),r=this.getExtraData();let o=n&&n.is("img,a")?n:null;o&&o.parent().is(".captionImage")&&(o=o.parent());const s=n&&n.is("img")?n:t("<img />");s.attr(a).addClass("ss-htmleditorfield-file image");let d=s.parent(".captionImage"),l=d.find(".caption");r.CaptionText?(d.length||(d=t("<div></div>")),d.attr("class",`captionImage ${a.class}`).removeAttr("data-mce-style").width(a.width),l.length||(l=t('<p class="caption"></p>').appendTo(d)),l.attr("class",`caption ${a.class}`).text(r.CaptionText)):(d=null,l=null);const c=d||s;return o&&o.not(c).length&&o.replaceWith(c),d&&d.prepend(s),o||(i.repaint(),i.insertContent(t("<div />").append(c).html(),{skip_undo:1})),i.addUndo(),i.repaint(),!0},statusMessage(e,i){const a=t("<div/>").text(e).html();n.default.noticeAdd({text:a,type:i,stayTime:5e3,inEffect:{left:"0",opacity:"show"}})}})})}();