---
Name: session-handlers
---
SilverStripe\Core\Injector\Injector:
  SilverStripe\Control\SessionHandler\CacheSessionHandler:
    constructor:
      cache: '%$Psr\SimpleCache\CacheInterface.session-handler'

  SilverStripe\Core\Cache\RedisCacheFactory:
    constructor:
      logger: '%$Psr\Log\LoggerInterface'

  SilverStripe\Core\Cache\MemcachedCacheFactory:
    constructor:
      logger: '%$Psr\Log\LoggerInterface'

  Psr\SimpleCache\CacheInterface.session-handler:
    factory: '`SS_SESSION_CACHE_FACTORY`'
    constructor:
      namespace: 'session-handler'
      defaultLifetime: 0
      useInjector: true
      # Use of the DefaultCacheFactory shouldn't be encouraged, but
      # is technically valid so we have to disable containers to avoid
      # weird behaviour with versioned, etc.
      disable-container: true

SilverStripe\Dev\Command\DbBuild:
  extensions:
    DbBuildSessionExtension: 'SilverStripe\Control\SessionHandler\DbBuildSessionExtension'

---
Name: 'session-handlers-test-session'
Only:
  moduleexists: 'silverstripe/testsession'
---
SilverStripe\TestSession\TestSessionEnvironment:
  extensions:
    DbBuildSessionExtension: 'SilverStripe\Control\SessionHandler\DbBuildSessionExtension'
